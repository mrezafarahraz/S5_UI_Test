namespace SADRA5.Monitor.Helpers
{
    public class NTCConverter
    {
        private readonly double[] _ntcResistance = {
            607800, 569604, 534036, 500901, 470019, 441224, 414363, 389296, 365893, 344034,
            323609, 304517, 286662, 269958, 254324, 239686, 225976, 213129, 201087, 189794,
            179200, 169258, 159925, 151159, 142924, 135185, 127908, 121065, 114626, 108566,
            102861, 97487, 92425, 87653, 83155, 78913, 74910, 71133, 67568, 64201,
            61020, 58014, 55174, 52487, 49947, 47543, 45268, 43115, 41076, 39144,
            37313, 35578, 33934, 32374, 30894, 29490, 28155, 26888, 25685, 24543,
            23457, 22425, 21444, 20512, 19624, 18780, 17977, 17212, 16484, 15791,
            15130, 14501, 13901, 13329, 12783, 12263, 11766, 11293, 10840, 10409,
            10000, 9602, 9226, 8866, 8522, 8194, 7879, 7579, 7291, 7016,
            6752, 6500, 6258, 6027, 5805, 5592, 5389, 5194, 5007, 4827,
            4655, 4490, 4331, 4179, 4033, 3893, 3758, 3629, 3505, 3385,
            3271, 3160, 3054, 2952, 2854, 2760, 2669, 2582, 2498, 2417,
            2339, 2264, 2191, 2122, 2055, 1990, 1928, 1868, 1810, 1754,
            1700, 1648, 1598, 1550, 1503, 1458, 1414, 1372, 1332, 1293,
            1255, 1218, 1183, 1149, 1116, 1084, 1053, 1023, 994.2, 966.3,
            939.3, 913.2, 887.9, 863.4, 839.7, 816.8, 794.6, 773.1, 752.3, 732.1,
            712.6, 693.6, 675.3, 657.5, 640.3, 623.6, 607.4, 591.6, 576.4, 561.6,
            547.3, 533.4, 519.9, 506.8, 494.1, 481.8, 469.8, 458.2, 446.9, 435.9,
            425.3, 414.9, 404.9, 395.1, 385.6, 376.4, 367.4, 358.7, 350.3, 342,
            334, 326.3, 318.7, 311.3, 304.2, 297.2, 290.4, 283.8, 277.4, 271.2,
            265.1, 259.2, 253.4, 247.8, 242.3, 237
        };

        public double Convert(int adcValue)
        {
            double voltage = adcValue * 0.00063;
            double resistance = (10000.0 * voltage) / (3.3 - voltage);

            if (resistance >= _ntcResistance[0]) return -55;

            for (int i = 1; i < _ntcResistance.Length; i++)
            {
                if (resistance >= _ntcResistance[i] && resistance < _ntcResistance[i - 1])
                {
                    return i - 55;
                }
            }

            return 0;
        }
    }
}
